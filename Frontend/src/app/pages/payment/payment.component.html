<div class="p-m-4">
  <h2>Payment</h2>

  <p>Order ID: {{ orderId }}</p>

  <div *ngIf="loadingItems" class="p-mt-2">
    <i class="pi pi-spin pi-spinner"></i> Loading order items...
  </div>

  <div *ngIf="orderItems.length > 0" class="p-mt-3">
    <h4>Order Items</h4>
    <p-table [value]="orderItems">
      <ng-template pTemplate="header">
        <tr>
          <th>Product</th>
          <th>Quantity</th>
          <th>Price</th>
          <th>Total</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.productName }}</td>
          <td>{{ item.quantity }}</td>
          <td>{{ item.price | currency }}</td>
          <td>{{ item.quantity * item.price | currency }}</td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Select Payment Method -->
  <div class="p-field p-mt-3">
    <label for="method">Payment Method</label>
    <p-dropdown
      id="method"
      [options]="paymentMethods"
      [(ngModel)]="selectedMethod"
      placeholder="Select method"
      optionLabel="label"
      optionValue="value"
      styleClass="w-full"
    ></p-dropdown>
  </div>

  <!-- Credit Card Info -->
  <div *ngIf="selectedMethod === 'card'" class="p-mt-3">
    <div class="p-field">
      <label for="cardNumber">Card Number</label>
      <input
        id="cardNumber"
        type="text"
        pInputText
        [(ngModel)]="cardNumber"
        maxlength="16"
        placeholder="1234 5678 9012 3456"
      />
    </div>
    <div class="p-field">
      <label for="expiry">Expiry Date</label>
      <input
        id="expiry"
        type="text"
        pInputText
        [(ngModel)]="expiry"
        placeholder="MM/YY"
      />
    </div>
    <div class="p-field">
      <label for="cvv">CVV</label>
      <input
        id="cvv"
        type="password"
        pInputText
        maxlength="4"
        [(ngModel)]="cvv"
        placeholder="***"
      />
    </div>
  </div>

  <button
    pButton
    type="button"
    label="Confirm Payment"
    class="p-mt-3"
    (click)="pay()"
  ></button>

  <!-- Payment Result -->
  <div *ngIf="paymentResult" class="p-mt-4">
    <h3>Payment Receipt</h3>
    <p>ID: {{ paymentResult.id }}</p>
    <p>Status: {{ paymentResult.status }}</p>
    <p>Amount: {{ paymentResult.amount | currency }}</p>
    <p>Date: {{ paymentResult.paymentDate | date:'short' }}</p>

    <button
      pButton
      label="Go to My Orders"
      class="p-mt-3 p-button-success"
      (click)="goToOrders()"
    ></button>
  </div>
</div>

<p-toast></p-toast>
